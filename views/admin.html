<!DOCTYPE html>
<html lang="en">
<head>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script type="text/javascript" src="/socket.io/socket.io.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/js/append.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link type="text/css" href="/css/bootstrap.min.css" rel="stylesheet" />
<link type="text/css" href="/css/bootstrap-responsive.min.css" rel="stylesheet" />
<link type="text/css" href="/css/style.css" rel="stylesheet" />
</head>
<body>
<div class="navbar navbar-inverse navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container-fluid"> <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a> <a class="brand" href="#">Project name</a>
      <div class="nav-collapse collapse">
        <p class="navbar-text pull-right"> Logged in as <a href="#" class="navbar-link">Username</a> </p>
        <ul class="nav">
          <li class="active"><a href="#">Home</a></li>
          <li><a href="#about">About</a></li>
          <li><a href="#contact">Contact</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>
<div id="tweets-admin" class="container-fluid" style="margin-top:60px;">
  <div class="row-fluid">
    <div class="span12">
      <div class="navbar">
        <div class="navbar-inner">
          <form name="twitter_search" id="twitter-search" class="navbar-search pull-left">
            <input type="text" name="hashtag_search" id="hashtag-to-search" class="search-query" placeholder="Search Twitter">
          </form>
        </div>
      </div>
    </div>
  </div>
  <div class="row-fluid">
    <div class="span6">
      <h3>Timeline</h3>
      <div id="tweets-content"></div>
    </div>
    <div class="span6">
      <h3>Approved Tweets</h3>
      <div id="approved-tweets-content"></div>
    </div>
  </div>
</div>

<script type="text/javascript">
    jQuery(document).ready(function($){
        var currentHashtag = "";
        
        $('#twitter-search').submit(function(e) {
            var hashtagToSearch = $("#hashtag-to-search").val();
            
            if((hashtagToSearch !== currentHashtag) && (hashtagToSearch !== "")) {
                currentHashtag = hashtagToSearch;
                
                $("#approved-tweets-content").empty();
                $("#tweets-content").empty();
                
                socket.emit('subscribe', {'hashtag':currentHashtag});
            }

            return false;
        });

        $('#tweets-content').on('click', '.approve-btn', function() {
                var parent = $(this).parents('.tweet');

                var approvedTweet = {
                    'tweet': parent.find('.tweet-content').text(), 
                    'username': parent.find('.user').text(), 
                    'image': parent.find('img').attr('src')
                };
                
                var approvedMessage = {
                    'tweet': approvedTweet,
                    'hashtag': currentHashtag 
                };
    
                socket.emit('approve', approvedMessage);
                
                parent.fadeOut('fast');
                
                appendApproved(approvedTweet,  $("#approved-tweets-content"));
        });        
    });
    
    (function() {
        var socket = io.connect();
        
        socket.on('seed-messages', function(message) {
            appendTweets(message);
        });
        
        socket.on('seed-approvals', function(message) {
            var approvals = message.approvals;
            var appendLoc =  $("#approved-tweets-content");
            
            for(var i = 0; i< approvals.length; i++) {
                appendApproved(approvals[i], appendLoc);
            }
        });
        
        socket.on('new-tweets', function(message){
            appendTweets(message);
        });
        
        socket.on('approved', function(message){
            appendApproved(message, $("#approved-tweets-content"));
        });
    })();
</script>
</body>
</html>